# Tessera Phase III POC è¨­è¨ˆå®šç¾©æ›¸

**Version:** 0.1.0
**Date:** 2026-01-15
**Status:** è¨­è¨ˆç¢ºå®šã€å®Ÿè£…å¾…ã¡
**Author:** beachcities + Claude Opus + Gemini + Copilot

---

## 0. æœ¬æ–‡æ›¸ã®ä½ç½®ã¥ã‘

æœ¬æ–‡æ›¸ã¯ã€Phase III ã®æ ¸ã¨ãªã‚‹ **Tesseract Field Module** ã®è¨­è¨ˆã‚’å®šç¾©ã™ã‚‹ã€‚
Geminiã€Copilot ã¨ã®å£æ‰“ã¡ã‚’çµŒã¦ã€3è€…ã®è¦‹è§£ãŒåŽæŸã—ãŸå†…å®¹ã‚’ Claude Opus ãŒçµ±åˆãƒ»æ•´ç†ã—ãŸã€‚

---

## 1. èƒŒæ™¯ã¨ç›®çš„

### 1.1 Phase II ã®æˆæžœ

- 200,000 ã‚²ãƒ¼ãƒ  â†’ 1,000,000 ã‚²ãƒ¼ãƒ ã®è‡ªå·±å¯¾æˆ¦å­¦ç¿’ã‚’å®Œäº†
- ELO 1496-1517 ã‚’é”æˆ
- GPU å†…å®Œçµã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç¢ºç«‹
- MambaStateCapture å‰Šé™¤ã«ã‚ˆã‚‹ OOM è§£æ±º

### 1.2 Phase III ã®ç›®æ¨™

Phase II ã§ç¢ºç«‹ã—ãŸå­¦ç¿’åŸºç›¤ã®ä¸Šã«ã€**ç‰©ç†å ´ã¨ã—ã¦ã®å›²ç¢ãƒ¢ãƒ‡ãƒ«**ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚

| ç›®æ¨™ | å†…å®¹ |
|------|------|
| ç‰©ç†å ´ãƒ¢ãƒ‡ãƒ« | 2å ´ï¼ˆÎ¦_B, Î¦_Wï¼‰+ ã‚³ã‚¦æ®‹æ»“å ´ï¼ˆKï¼‰ã®æ‹¡æ•£ã‚¨ãƒ³ã‚¸ãƒ³ |
| é•·è·é›¢èªè­˜ | 19^4 ã‚«ãƒ¼ãƒãƒ«ã®è»½é‡å®Ÿè£…ï¼ˆray-cast æ–¹å¼ï¼‰ |
| VRAM åˆ¶ç´„ | 8GB ä»¥å†…ã§ Batch Size 16+ ã‚’ç¶­æŒ |

---

## 2. ç‰©ç†å ´ãƒ¢ãƒ‡ãƒ«

### 2.1 3ã¤ã®å ´

| å ´ | è¨˜å· | æ„å‘³ |
|----|------|------|
| é»’ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«å ´ | Î¦_B | é»’çŸ³ã®å½±éŸ¿åŠ›ãŒæ‹¡æ•£ã™ã‚‹ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« |
| ç™½ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«å ´ | Î¦_W | ç™½çŸ³ã®å½±éŸ¿åŠ›ãŒæ‹¡æ•£ã™ã‚‹ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ« |
| ã‚³ã‚¦æ®‹æ»“å ´ | K | æ™‚é–“çš„ãªæ­ªã¿ã€ç€æ‰‹ç¦æ­¢ï¼‹ç”Ÿå­˜é–¾å€¤ã¸ã®å½±éŸ¿ |

### 2.2 æ‹¡æ•£æ›´æ–°å‰‡
```
Î¦^{t+1}(x) = (1-Î±)Î¦^{t}(x) + Î±ãƒ»mean_{yâˆˆN(x)}Î¦^{t}(y) + Î²ãƒ»S(x)
```

- Î±: æ‹¡æ•£çŽ‡ï¼ˆ0.1ã€œ0.3ï¼‰
- Î²: ã‚½ãƒ¼ã‚¹æ³¨å…¥å¼·åº¦
- N(x): è¿‘å‚ï¼ˆ4è¿‘å‚ + å¯¾è§’ï¼‰
- S(x): çŸ³é…ç½®ã«ã‚ˆã‚‹ã‚½ãƒ¼ã‚¹é …

### 2.3 ã‚³ã‚¦æ®‹æ»“å ´ã®æ›´æ–°
```
K_{t+1}(x) = Ïãƒ»K_t(x) + Î³ãƒ»ðŸ™_{ko-at(x,t)}
```

- Ï: æ¸›è¡°ä¿‚æ•°ï¼ˆ0.5ã€œ0.8ï¼‰
- Î³: ã‚³ã‚¦ç™ºç”Ÿæ™‚ã®ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«æ³¨å…¥é‡
- æ•°æ‰‹ã‹ã‘ã¦æŒ‡æ•°æ¸›è¡°ã™ã‚‹é€£ç¶šå€¤

### 2.4 ç”Ÿå­˜åˆ¤å®š
```python
p_field = where(board > 0, b_field, where(board < 0, w_field, 0.0))
death_threshold = base_threshold + Î· * K
survival_mask = sigmoid(steepness * (p_field - death_threshold))
new_board = board * survival_mask
```

---

## 3. 19^4 ã‚«ãƒ¼ãƒãƒ«ã®è»½é‡åŒ–è¨­è¨ˆ

### 3.1 å•é¡Œ

- ãƒ•ãƒ« 19^4 ãƒ†ãƒ³ã‚½ãƒ«: 130,321 è¦ç´  Ã— FP32 = ç´„ 520MB
- å‹¾é…ã‚’å«ã‚ã‚‹ã¨ 8GB VRAM ã§ OOM

### 3.2 è§£æ±ºç­–ï¼šéšŽå±¤çš„ ray-cast

| ãƒ¬ãƒ™ãƒ« | ç¯„å›² | å®Ÿè£… | è¨ˆç®—é‡ |
|--------|------|------|--------|
| 1 | è¿‘è·é›¢ dâ‰¤3 | ãƒ•ãƒ« 2ç‚¹ç›¸é–¢ or Conv | O(Nãƒ»RÂ²) |
| 2 | ä¸­è·é›¢ | 8æ–¹å‘ ray-cast | O(Nãƒ»Dãƒ»R') |
| 3 | é è·é›¢ | ã‚¯ãƒ©ã‚¹ã‚¿ or FFTï¼ˆå°†æ¥ï¼‰ | O(N log N) |

### 3.3 8æ–¹å‘ ray-cast
```
E = Î£_d Î£_r A_d(r) * F(x + r*v_d)
```

- d: æ–¹å‘ï¼ˆ8æ–¹å‘ï¼šä¸Šä¸‹å·¦å³ + æ–œã‚4ï¼‰
- r: è·é›¢ï¼ˆ1ã€œR'ï¼‰
- v_d: æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«
- A_d(r): æ–¹å‘ãƒ»è·é›¢ã«å¯¾ã™ã‚‹é‡ã¿

### 3.4 D8 å¯¾ç§°æ€§

- ç›´ç·š4æ–¹å‘ï¼ˆä¸Šä¸‹å·¦å³ï¼‰: åŒä¸€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…±æœ‰
- æ–œã‚4æ–¹å‘: åŒä¸€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å…±æœ‰
- å›žè»¢ãƒ»åè»¢ã«å¯¾ã—ã¦ä¸å¤‰

---

## 4. ãƒ†ãƒ³ã‚½ãƒ«å½¢çŠ¶å®šç¾©

### 4.1 å…¥åŠ›ãƒ†ãƒ³ã‚½ãƒ«ï¼ˆæ‹¡æ•£ snapshotï¼‰
```python
F: [B, C_in, 19, 19]
# B: ãƒãƒƒãƒã‚µã‚¤ã‚ºï¼ˆ16ï¼‰
# C_in: ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒãƒ£ãƒ³ãƒãƒ«ï¼ˆ3: t=2,5,10ï¼‰
```

### 4.2 ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–¹å¼Aï¼‰
```python
index_table: [8, R', 19, 19, 2]
# 8: æ–¹å‘æ•°
# R': æœ€å¤§è·é›¢ï¼ˆ18ï¼‰
# 19, 19: ç›¤é¢åº§æ¨™
# 2: (k, l) åº§æ¨™
```

- ç¯„å›²å¤–ã¯ sentinel (-1, -1) ã§åŸ‹ã‚ã‚‹
- äº‹å‰è¨ˆç®—ã—ã¦ãƒãƒƒãƒ•ã‚¡ã¨ã—ã¦ä¿æŒ

### 4.3 Gather å¾Œãƒ†ãƒ³ã‚½ãƒ«
```python
gathered: [B, C_in, 8, R', 19, 19]
```

### 4.4 é‡ã¿ãƒ†ãƒ³ã‚½ãƒ«
```python
A: [8, R']  # ã‚¹ã‚«ãƒ©ãƒ¼ç‰ˆ
# ã¾ãŸã¯
A: [2, R']  # D8å¯¾ç§°æ€§ã‚’æ´»ç”¨ï¼ˆç›´ç·š/æ–œã‚ã®2ã‚°ãƒ«ãƒ¼ãƒ—ï¼‰
```

### 4.5 å‡ºåŠ›ãƒ†ãƒ³ã‚½ãƒ«
```python
L: [B, C_out, 19, 19]
# C_out: é•·è·é›¢ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ãƒãƒ£ãƒ³ãƒãƒ«
```

### 4.6 VRAM è¦‹ç©ã‚‚ã‚Š
```
Gather å¾Œ: [16, 3, 8, 18, 19, 19]
è¦ç´ æ•°: 16 Ã— 3 Ã— 8 Ã— 18 Ã— 361 â‰ˆ 2.5M
FP32: ç´„ 10MB
```

**ãƒ•ãƒ« 19^4ï¼ˆ520MBï¼‰ã®ç´„ 2%** ã§é•·è·é›¢èªè­˜ãŒå¯èƒ½ã€‚

---

## 5. POC-1 å®šç¾©

### 5.1 ç›®æ¨™

8æ–¹å‘ ray-cast ã®å®Ÿè£…ã¨ VRAM/é€Ÿåº¦ã®æ¤œè¨¼

### 5.2 ã‚¹ã‚³ãƒ¼ãƒ—

| é …ç›® | POC-1 | å°†æ¥ |
|------|-------|------|
| ãƒ¬ãƒ™ãƒ«1ï¼ˆè¿‘è·é›¢ï¼‰ | Conv ã§ä»£ç”¨ | ãƒ•ãƒ« 2ç‚¹ç›¸é–¢ |
| ãƒ¬ãƒ™ãƒ«2ï¼ˆä¸­è·é›¢ï¼‰ | **8æ–¹å‘ ray-cast** | - |
| ãƒ¬ãƒ™ãƒ«3ï¼ˆé è·é›¢ï¼‰ | æœªå®Ÿè£… | ã‚¯ãƒ©ã‚¹ã‚¿/FFT |

### 5.3 å…¥åŠ›
```python
F: [B, C_in, 19, 19]  # æ‹¡æ•£ snapshot
```

### 5.4 å‡ºåŠ›
```python
L: [B, C_out, 19, 19]  # é•·è·é›¢ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«
```

### 5.5 æˆåŠŸåŸºæº–

| åŸºæº– | ç›®æ¨™å€¤ |
|------|--------|
| VRAM | Batch 16 ã§ 8GB ä»¥å†… |
| D8 å¯¾ç§°æ€§ | å›žè»¢ãƒ»åè»¢ã§å‡ºåŠ›ä¸å¤‰ |
| å‹¾é… | ãƒãƒƒã‚¯ãƒ—ãƒ­ãƒ‘ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ |
| é€Ÿåº¦ | 1 forward < 10ms |

### 5.6 å®Ÿè£…æ–¹å¼

**æ–¹å¼Aï¼ˆindex table + gatherï¼‰**ã‚’å…ˆè¡Œå®Ÿè£…
```python
# ç–‘ä¼¼ã‚³ãƒ¼ãƒ‰
index_table = precompute_ray_indices()  # [8, R', 19, 19, 2]
gathered = gather_along_rays(F, index_table)  # [B, C_in, 8, R', 19, 19]
weighted = gathered * A[None, None, :, :, None, None]
L = weighted.sum(dim=(2, 3))  # [B, C_in, 19, 19]
```

å‹•ä½œç¢ºèªå¾Œã€**æ–¹å¼Bï¼ˆãƒãƒ£ãƒ³ãƒãƒ«å±•é–‹ + 1Ã—1 convï¼‰**ã«æœ€é©åŒ–

---

## 6. POC-2 å®šç¾©ï¼ˆå°†æ¥ï¼‰

### 6.1 ç›®æ¨™

æ‹¡æ•£ã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆ2å ´ + Kï¼‰ã®å®‰å®šåŒ–

### 6.2 æ¤œè¨¼é …ç›®

- ã‚¨ãƒãƒ«ã‚®ãƒ¼ä¿å­˜å‰‡
- å‹¾é…çˆ†ç™ºã®é˜²æ­¢
- æ‹¡æ•£ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®æœ€é©åŒ–

---

## 7. å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒžãƒƒãƒ—

| ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ | æˆæžœç‰© |
|----------|------|--------|
| POC-1a | index_table ç”Ÿæˆ | `ray_index.py` |
| POC-1b | gather å®Ÿè£… | `ray_cast.py` |
| POC-1c | VRAM/é€Ÿåº¦è¨ˆæ¸¬ | ãƒ™ãƒ³ãƒãƒžãƒ¼ã‚¯çµæžœ |
| POC-1d | D8 å¯¾ç§°æ€§æ¤œè¨¼ | ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ |
| POC-2 | æ‹¡æ•£ã‚¨ãƒ³ã‚¸ãƒ³ | `diffusion.py` |
| çµ±åˆ | æ‹¡æ•£ â†’ ray-cast â†’ Policy | `tesseract_field.py` |

---

## 8. è¨­è¨ˆåŽŸå‰‡ï¼ˆç¶™ç¶šï¼‰

| åŽŸå‰‡ | èª¬æ˜Ž |
|------|------|
| GPU Complete | å…¨æ“ä½œãŒ GPU å†…ã§å®Œçµ |
| Batch First | å…¨æ“ä½œãŒãƒãƒƒãƒåŒ– |
| No Python Loop | ãƒ«ãƒ¼ãƒ—ã¯ torch æ¼”ç®—ã«ç½®æ› |
| Clean Room | å¤–éƒ¨æ£‹è­œã‚’ä½¿ç”¨ã—ãªã„ |
| Observable | å…¨ã¦ã®æŒ™å‹•ãŒãƒ¢ãƒ‹ã‚¿ãƒ¼å¯èƒ½ |
| **Physics First** | å›²ç¢ã®å¹¾ä½•å­¦ã‚’ç‰©ç†æ³•å‰‡ã¨ã—ã¦åŸ‹ã‚è¾¼ã‚€ |

---

## 9. å‚è€ƒï¼šå£æ‰“ã¡ã®çµŒç·¯

### 9.1 Gemini ã¨ã®è­°è«–

- 2å ´ï¼ˆÎ¦_B, Î¦_Wï¼‰+ K ã®ç‰©ç†å ´ãƒ¢ãƒ‡ãƒ«
- æ¡ˆA vs æ¡ˆBï¼ˆ19^4 ã®çµåˆã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰
- æ‹¡æ•£ã‚¹ãƒ†ãƒƒãƒ—ã®éžå®šå¸¸ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

### 9.2 Copilot ã¨ã®è­°è«–

- 8GB VRAM åˆ¶ç´„ã®é‡è¦æ€§
- éšŽå±¤çš„ ray-cast ã®å…·ä½“è¨­è¨ˆ
- ãƒ†ãƒ³ã‚½ãƒ«å½¢çŠ¶ã®è©³ç´°å®šç¾©

### 9.3 åˆæ„äº‹é …

- **POC-1ï¼ˆ19^4 è»½é‡åŒ–ï¼‰ã‚’æœ€å„ªå…ˆ**
- **8æ–¹å‘ ray-cast ã‹ã‚‰ç€æ‰‹**
- **æ–¹å¼Aï¼ˆindex table + gatherï¼‰ã§å…ˆè¡Œå®Ÿè£…**

---

## ä»˜éŒ² A: æ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«å®šç¾©
```python
DIRECTIONS = [
    ( 0,  1),  # ä¸Š
    ( 0, -1),  # ä¸‹
    ( 1,  0),  # å³
    (-1,  0),  # å·¦
    ( 1,  1),  # å³ä¸Š
    ( 1, -1),  # å³ä¸‹
    (-1,  1),  # å·¦ä¸Š
    (-1, -1),  # å·¦ä¸‹
]
```

---

## ä»˜éŒ² B: D8 å¯¾ç§°æ€§ã‚°ãƒ«ãƒ¼ãƒ—
```python
# ç›´ç·šã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…±æœ‰ï¼‰
LINE_GROUP = [0, 1, 2, 3]  # ä¸Šä¸‹å·¦å³

# æ–œã‚ã‚°ãƒ«ãƒ¼ãƒ—ï¼ˆãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å…±æœ‰ï¼‰
DIAG_GROUP = [4, 5, 6, 7]  # 4æ–œã‚
```

---

*"Le symbole donne Ã  penser."* â€” Paul RicÅ“ur

*The field thinks.*
